---
title: 登录功能(一)
description: 登录功能技术要点与相关理论
---
现在已经很少能够找出无用户的网站（或许博客是少有的无用户网站），现在无论是看个视频、听个音乐、下载资源、还是社交网络都需要用户有自己的账户，在信息为王的时代，用户信息对互联网公司是很重要的，因此创建账户对许多网站来说是绕不过去的坎。
有了账户的概念，自然就需要有登录操作，这个系列的文章就来好好聊聊这个登录操作。

## 认证
有三个层次上的认证：
- 通信信道上的认证：典型案例是基于SSL/TLS传输安全层的认证
- 通信协议上的认证：典型案例是HTTP协议上的认证信息，比如Authorization Header或是cookie
- 通信内容上的认证：web内容认证，payload中填写认证信息
三个层次彼此交融，互相渗透，并不是三者取其一的关系。


### 通信内容上的认证
一个账户就是一个用户的身份凭证，一个账户就代表了一个用户。
账户具有唯一性、排他性。*唯一性*是指每个账户都是独一无二的，在同一个互联网服务中不会存在两个一模一样的账户。*排他性*是指一个账户由固定的用户使用，用户只能使用自己的账户，用户不能使用其他用户的账号。
由于账户必须具有唯一性和排他性，账户必须由账户ID和密码组成。其中账户ID保证了账户的唯一性，而密码保证了账户的排他性。

进一步思考：一个账户必定由账户ID和密码组成吗？其实未必，我们发现只要由方式能同时满足唯一性和排他性，那么这个方式就能用来作为用户的凭证。如今生物识别已经发展成熟，每个人独特的生物特征同时满足了唯一性和排他性，所以理论上来说只采取生物识别信息便可以创建一个用户了(对应的web就是[WebAuthn](https://flyhigher.top/develop/2160.html))。当然，生物特征也可能随时间变化，所以单纯使用生物特征是不够保险的，因此以账户ID和密码为基本构成的账户暂时是不会被替代的。

登录就是确认用户身份的过程，用户需要提供他/她的账户ID和密码（或是其他等价方式）来证明自己的用户身份。

### 认证的实现
Java的认证范式往往有以下概念：
- Principal 存放用户信息
- Credentials 存放用户密码/凭证
- Context  存放登陆后的用户状态


## 授权
认证完之后（知道了你是谁），下一步就是确认用户的权限，即确认用户能做什么。
一个朴素的做法是，将网站上所有资源的权限信息放到与用户相关的一个权限数组里，比如用户A可以访问资源A、资源C，用户B可以访问资源C。
朴素做法的问题在于，一个真实的网站往往有庞大的用户群体和庞大的资源，在这两者之间做多对多的映射是特别复杂的。
于是出现了基于角色的访问控制（Role-Bases Access Control, RBAC），这种方法的思路是在资源和用户之间抽象出一层“角色”。
用户于角色是多对多的关系，角色和资源也是多对多的关系，只是角色数量比较少，这样便把问题简单化了。我们只需要管理有限的角色，而不是几乎无限的用户于资源的对应关系。

我们可以在许多网站中看到这样的策略，大多数网站只有两种角色：普通用户和VIP用户。VIP用户往往可以获得更多的资源。有些网站会把VIP用户分成多个层级，不同的层级访问资源的权限有大小之分。


