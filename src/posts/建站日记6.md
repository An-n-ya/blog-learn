---
title: 建站日记（六）目录功能
description: 修复部署bug + 增加目录功能
---

## node自动关闭问题
每次我退出终端后，node就会自动关闭，就算我用了`nohup node build &`到后台任务，还是不行。
于是我去安装了`pm2`（注意，centos下光安装node还不行，还得单独安装npm，`sudo yum install npm`），然后使用`pm2 start build/index.js`开启服务就不会被随意关闭啦。


## 引入Google Analytics
进入[google analytics](https://analytics.google.com/)创建一个账户，在这个账户里添加数据流。设置完成后会给一个Google代码的地址，大概长这样：
```html
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxxxxxxx"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-xxxxxxxxx');
</script>
```
把这段代码放入该项目的`app.html`的head标签下面，这样每个页面就都引入了这些代码了。
访问网站打开console，就能发现有向`google-analytics`的请求啦!
![](https://picture-bed-1301848969.cos.ap-shanghai.myqcloud.com/20230206201051.png)
注意到这些请求的旁边都有一个划斜线的盾牌图标，这是Firefox阻止tracker的策略，如果在设置里关掉Tracking content，这些请求就不会被block掉了。
![](https://picture-bed-1301848969.cos.ap-shanghai.myqcloud.com/20230206201543.png)
我这里设置成了只在隐私界面阻止。
登录google analytics，就能看到很清晰的访问数据，数据可能有些延时。
![](https://picture-bed-1301848969.cos.ap-shanghai.myqcloud.com/20230207162212.png)

## 下一步
- 响应式页面(手机端页面)
- 建立文章内的索引：在`[[]]`内写文章内的链接，参考obsidian语法
- 使用其他的remark插件:
  - code titile
  - toc
  - code-frontmatter
  - code-import
- post 卡片（展示字数信息）
- giscus 讨论区 https://giscus.app/
