---
title: 建站日记（四）自动部署+css
description: 优化页面样式，使用Github Action自动部署到腾讯云
---

## 页面样式美化
### 调整文章页宽度
之前的文章页太宽了，从左读到右找不到下一行了，看起来很累。

## 使用Github Action自动部署到腾讯云
使用ssh deploy这个action：https://github.com/marketplace/actions/ssh-deploy

### 添加一个专门用于github action的用户
创建github_action的用户：
```shell
useradd -m github_action
```
`-m`表示在`/home`下添加github_action 的目录

更改用户密码：
```shell
sudo passwd github_action
```

切换到github_action用户：
```shell
su github_action
```


注意：此时的目录可能还是主机目录，比如`ankh`，需要手动跳转到自己的目录：`cd /home/github_action`

在新用户下生成公钥
```shell
ssh-keygen -m PEM -t rsa -b 4096
```
复制公钥信息：` cat ~/.ssh/id_rsa.pub` 
登录服务器，在`~/.ssh/authorized_keys`中添加公钥信息。(注意：公钥之间需要有回车)

### 设置action工作流
在`.github/workflows`里添加main.yml文件：
```yml
name: Node CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Install Node.js
      uses: actions/setup-node@v1
      with:
        node-version: '16.14.2'
    - name: Install npm dependencies
      run: npm install
    - name: Run build task
      run: npm run build --if-present
    - name: Deploy to Server
      uses: easingthemes/ssh-deploy@main
      env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          ARGS: "-rlgoDzvc -i --delete"
          SOURCE: "/"
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          TARGET: "/home/ankh/blog"
          EXCLUDE: ""
          SCRIPT_AFTER: |
            # 这里把node进程都杀掉了...有点过于鲁莽，我们应该只删掉3000端口的进程
            killall node
            cd /home/ankh/blog
            node build &
            ls -al
            echo $RSYNC_STDOUT

```
由于我们的SvelteKit应用是非静态的，所以需要把整个文件都复制到我们的VPS，然后在blog目录执行`node build`，才能启动Svelte

### 设置Nginx 端口转发
由于我们的应用跑在3000端口，我们在nginx里边转发访问`ankh.host:80`的请求到3000端口
在Nginx的配置文件中加入下面的配置：
```conf
server
    {
        listen 80;
        server_name ankh.host;
        
        location ^~ / {
          proxy_pass http://127.0.0.1:3000/;
        }
    }
```